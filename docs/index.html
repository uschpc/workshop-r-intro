<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introduction to R</title>
    <meta charset="utf-8" />
    <meta name="author" content="Derek Strong   dstrong[at]usc.edu     Center for Advanced Research Computing   University of Southern California  " />
    <script src="index_files/header-attrs-2.10/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: left, top, title-slide

# Introduction to R
### Derek Strong <br> dstrong[at]usc.edu <br> <br> Center for Advanced Research Computing <br> University of Southern California <br>
### Last updated on 2021-09-24

---







## Learning objectives

- Explain the purpose of R
- Use objects and functions
- Perform basic data analysis tasks in R
  - Read and write data
  - Summarize data
  - Visualize data
  - Model data
- Develop and run an R script
- Use R on CARC systems

---

## Outline

1. Base R and packages
2. Objects and functions
3. Importing and exporting data
4. Summarizing data
5. Visualizing data
6. Modeling data
7. Control flow
8. Iteration
9. Scripting

---

## What is R?

![R](./images/Rlogo.png)

- A programming environment and language for statistical computing and graphics
  - A multi-paradigm programming language
  - A high-level (human-friendly) interpreted scripting language

---

## Why R?

- Main alternatives
  - Python
  - Julia
  - Stata
  - SAS
- Advantages
  - Designed for statistical computing
  - Free/libre/open source
  - Diverse community of users
  - Interpreted language (easy to write code compared to compiled language)
- Disadvantages
  - Interpreted language (performance penalty)
  - Two-language problem (improving performance with compiled language)

---

## Installing R

- Find instructions on [CRAN](https://cran.r-project.org/)
- Multiple versions installed on CARC systems
  - `module load usc r`
  - `module load usc r/&lt;version&gt;`
- Also consider using an integrated development environment (IDE)
  - [RStudio](https://www.rstudio.com/)
  - [JupyterLab](https://jupyter.org/)

---

## Using R

Two modes for the command-line interface (CLI):

| Mode | Command |
|---|---|
| Interactive (console) | `R` |
| Batch | `Rscript` |

---

## R console

Focus on the R console for learning R:


```r
$ R

R version 4.1.0 (2021-05-18) -- "Camp Pontanezen"
Copyright (C) 2021 The R Foundation for Statistical Computing
Platform: x86_64-apple-darwin17.0 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

&gt;
```

---

## Arithmetic operators

| Description | Operator |
|---|---|
| Addition | `+` |
| Subtraction | `-` |
| Multiplication | `*` |
| Division | `/` |
| Exponentiation | `^` or `**` |
| Integer division | `%/%` |
| Modulo | `%%` |

---

## Base R and packages

- A package is a formal collection of related R functions, objects, classes, etc.
- Base R is a stable set of core packages
- Some base packages are loaded automatically when starting a new R session
- Other packages that extend base R need to be installed
  - On Linux, most packages are compiled (if they contain C/C++/Fortran programs)
  - On macOS or Windows, binary versions are downloaded by default

*There's more than one way to do something in R*

---

## Installing and using packages

Main repositories:

- [CRAN](https://cran.r-project.org/)
- [Bioconductor](https://www.bioconductor.org/)
- Development versions from GitHub, GitLab, etc.

Install or remove with:


```r
install.packages("package")
BiocManager::install("package")
remotes::install_github("org/package")
remove.packages("package")
```

Load with:


```r
library(package)
```

*See [`renv`](https://cran.r-project.org/package=renv) package for reproducible package environments*

---

## Exercise 1

Install and load the `data.table` package

Get R session info with `sessionInfo()`

---

## Objects and functions

Two fundamental principles:

1. Everything that exists in R is an **object**
2. Everything that happens in R is a **function** call

---

## Objects

- An object is anything stored in the R environment
- Typically a data structure with associated attributes
- A data structure is composed of data types
- Could also be a function, a plot, etc.

---

## Data types

Atomic types:

- double (aka numeric or floating point)
- integer (aka numeric)
- complex
- character (aka string)
- logical (`TRUE` or `FALSE`)
- raw

Other classes based on atomic types:

- factor (categorical, based on integer)
- Date, POSIXct, POSIXlt, difftime, ts (based on double)

---

## Data structures

| Dimensions | Homogeneous data type | Heterogeneous data types |
|---|---|---|
| 1d | atomic vector | list | 
| 2d | matrix | data frame |
| nd | array | |

---

## Functions for creating data structures

| Data structure | Function | Coercion | Test |
|---|---|---|---|
| atomic vector | `c()` or `vector()` | `as.vector()` | `is.vector()` |
| matrix | `matrix()` | `as.matrix()` | `is.matrix()` |
| array | `array()` | `as.array()` | `is.array()` |
| list | `list()` or `c()` or `vector()` | `as.list()` | `is.list()` |
| data frame | `data.frame()` | `as.data.frame()` | `is.data.frame()` |

---

## Creating objects

Create an object by assigning a value to a name

Example for a simple vector:


```r
vec &lt;- c(1, 2, 3, 4)
```

- `vec` is the name of the object
- `&lt;-` is the assignment operator
- `c()` creates a vector object
- `c(1, 2, 3, 4)` is the value of the object

---

## Inspecting objects

- `ls()` to list objects
- `rm()` to remove objects
- `class()` to print class of object
- `str()` to display the structure of an object

Example for a simple vector:


```r
vec &lt;- c(1, 2, 3, 4)
ls()
class(vec)
str(vec)
rm(vec)
```

---

## Missing values

Missing values are represented by `NA` (considered logical)


```r
missing &lt;- c(1, 2, 3, NA)
is.na(missing)
anyNA(missing)
missing[!is.na(missing)]
```

*Many functions have an `na.rm` argument to ignore/remove missing values*

---

## The data frame

- Probably the most commonly used data structure
- 2d with a mix of numeric, character, factor, etc. columns
- Technically implemented as a list (set of vectors with the same length)

Example:


```r
iris
head(iris)
tail(iris)
str(iris)
is.data.frame(iris)
is.list(iris)
```

---

## The list

- A generic vector for a collection of objects
- Useful for iteration purposes

Example:


```r
mix &lt;- list(iris, uspop)
str(mix)
is.list(mix)
as.list(iris)
```

---

## Exercise 2

Create a list of two atomic vectors of different types and lengths

Display the structure of that list

---

## The functional perspective

R is mostly used as a functional programming language

Inputs and outputs:

.center[input object (argument) &amp;rarr; `func()` &amp;rarr; output object (value)]

Example:

.center[data frame &amp;rarr; `summary()` &amp;rarr; table of summary statistics]

---

## Functions

A function is a unit of code that takes an input and produces an output

Generic structure of functions in R:


```r
func(arg1, arg2, ...)
```

- `func` is the function name
- `arg1`, `arg2` are arguments passed to function
- `...` represents other optional arguments

Notes on using functions:

- Arguments can be optional and may have default values
- Argument names may need to be made explicit (e.g., `arg3 = value`)
- Can also use syntax `package::func()` (if package is not loaded)
- `print()` is the default function

---

## Function example

Variations of a `summary()` function call:


```r
summary(iris)
summary(object = iris)
summary(iris, digits = 5)
base::summary(iris)
```

---

## Nesting functions

Function within a function example:


```r
str(summary(iris))
```

Or explicitly create intermediate objects:


```r
sum &lt;- summary(iris)
str(sum)
rm(sum)
```

Or use pipe operator `%&gt;%` from `magrittr` package:


```r
library(magrittr)
iris %&gt;%
  summary() %&gt;%
  str()
```

*May improve code readability*

---

## Creating functions

Define a function and assign it a name

Example:


```r
math &lt;- function(x, y) {
  z &lt;- x + y
  z * x
}
```

- Create functions when reusing a set of code frequently
- DRY principle (do not repeat yourself)

---

## Getting help

For specific function:


```r
?func
```

For general search:


```r
??keyword
```

For specific package:


```r
library(help = "pkg")
```

---

## Exercise 3

Create a function that performs some sequence of arithmetic

---

## Working with files

Main functions:

- `getwd()`
- `setwd()`
- `list.files()`

*Best practice is to organize R project files in unique directories, use relative paths*

---

## Importing and exporting data

Best to avoid base R and use other packages:

| Data format | Package |
|---|---|
| Text | `readr`, `vroom`, `data.table` |
| Binary | `arrow` |
| Foreign | `foreign`, `haven` |
| Database | `odbc`, `DBI`, `RMariaDB`, `RPostgreSQL`, `RSQLite` |
| HDF5 | `hdf5r` |
| NetCDF | `ncdf4`, `RNetCDF` |
| Spatial | `raster`, `sf`, `terra`, `stars` |

---

## Exercise 4

Import a CSV file using the `readr` package

Export a CSV file using the `readr` package

---

## Indexing operators

| Description | Operator |
|---|---|
| Select one or more elements or rows/columns | `x[ ]` |
| Select one element or column | `x[[ ]]` |
| Select one element or column by name | `x$name` |

- Use indexing operators for replacing values or subsetting (aka slicing)
- Subsetting will typically simplify data structure by default

Some examples:


```r
iris[1, 2] &lt;- 3
iris[ , 1:2]
iris[1:2, ]
iris[1:2, 1:2]
iris[[1]]
iris[[2]][1:4]
iris$Sepal.Length
iris$Sepal.Length &lt;- NULL
iris[["Species"]]
```

---

## Relational operators

| Relation | Operator |
|---|---|
| Equal to | `==` |
| Not equal to | `!=` |
| Lesser than | `&lt;` |
| Greater than | `&gt;` |
| Lesser than or equal to | `&lt;=` |
| Greater than or equal to | `&gt;=` |

Some examples:


```r
iris[1, 2] == 2
iris[1, 2] != 2
iris[1, 2] &gt;= 2
```

---

## Logical operators

| Logic | Operator |
|---|---|
| NOT (negation) | `!` |
| Element-wise AND (multiple TRUE) | `&amp;` |
| AND (first element)  | `&amp;&amp;` |
| Element-wise OR (one TRUE) | &amp;vert; |
| OR (first element) | &amp;vert;&amp;vert; |

Some examples:


```r
!TRUE
TRUE &amp; TRUE
TRUE &amp; FALSE
FALSE &amp; FALSE
TRUE | FALSE
FALSE | FALSE
```

---

## Subsetting examples


```r
iris[iris$Species == "setosa", ]
iris[iris$Species != "setosa", ]
iris[iris$Sepal.Length &gt; 5 &amp; iris$Sepal.Width &lt; 3, ]
iris[iris$Sepal.Length &gt; 5 &amp; iris$Sepal.Width &lt; 3, 1:2]
iris[iris$Sepal.Length &gt; 5 | iris$Sepal.Width &lt; 3, ]
```

Other packages with subsetting functions:

- `data.table`
- `dplyr`

---

## Summarizing data

Some examples:


```r
str(iris)

summary(iris)
summary(iris[ , 1:2])

library(skimr)
skim(iris)
```

---

## Exercise 5

Summarize the airquality dataset

---

## Visualizing data

Many graphics functions:

- `plot()`, `pairs()`, `boxplot()`, `hist()`, `dotchart()`, `mosaicplot()`, `contour()`
- `png()`, `jpeg()`, `tiff()`, `pdf()`
- Many options for customizing graphics
- Other packages:
  - `ggplot2`
  - `leaflet`
  - `plotly`
  - `shiny`

---

## Graphics examples


```r
hist(iris$Sepal.Length)
boxplot(iris$Sepal.Length)
plot(iris$Sepal.Length, iris$Sepal.Width)

png("uspop.png")
plot(uspop)
dev.off()
```

---

## Exercise 6

Plot the discoveries dataset

---

## Modeling data

The base `stats` package has many statistical functions:

- `lm()` for linear models
- `glm()` for generalized linear models
- See more: `library(help = "stats")`
- Many other packages for statistical modeling

---

## Model examples

Linear model:


```r
model &lt;- lm(Sepal.Length ~ Sepal.Width + Species, iris)
summary(model)
AIC(model)
BIC(model)
```

Survival model:


```r
library(survival)
data &lt;- data.frame(time = c(4, 3, 1, 1, 2, 2, 3), 
                   status = c(1, 1, 1, 0, 1, 1, 0), 
                   x = c(0, 2, 1, 1, 1, 0, 0), 
                   sex = c(0, 0, 0, 0, 1, 1, 1))
model &lt;- coxph(Surv(time, status) ~ x + strata(sex), data)
summary(model)
```

---

## Control flow

Controlling the flow of execution

If statements:


```r
if (cond) {expr}
if (cond) {expr} else {alt.expr}
```

Loops:


```r
for (var in seq) {expr}
while (cond) {expr}
repeat {expr}
break
next
```

---

## If statement example

Within a function:


```r
math &lt;- function(x, y) {
  z &lt;- x + y
  
  if (z &gt; 10) {
    z * 2
  } else {
    z / 2
  }
}

math(2, 2)
math(7, 7)
```

---

## While loop example


```r
i &lt;- 1
while (i &lt; 100) {
  print(i)
  i = i * 2
}
```

---

## Iteration

Loop over multiple inputs and perform some task

Two approaches:

1. `for` loops
2. `*apply()` family of functions
  - `lapply()`, `sapply()`, `vapply()`, `tapply()`, `mapply()`
  - different use cases

---

## Iteration examples


```r
mats &lt;- list(matrix(rnorm(25), ncol = 5),
             matrix(rnorm(25), ncol = 5),
             matrix(rnorm(25), ncol = 5))

for (i in seq_along(mats)) {
  print(eigen(mats[[i]]))
}

lapply(mats, eigen)

mats2 &lt;- list(matrix(rnorm(25), ncol = 5),
              matrix(rnorm(25), ncol = 5),
              matrix(rnorm(25), ncol = 5))

mapply(crossprod, mats, mats2, SIMPLIFY = FALSE)
```

---

## Exercise 7

Loop over a list of datasets and summarize them

---

## Scripting

- A script is a file with a set of commands to be run in sequence
- Text file saved with `.R` extension
- Documents your analysis and workflows
- Enables reproducibility
- Write comments by starting line with `#`
- Typically best to organize scripts in a modular way
- To run R scripts:
  - Within R console: `source()`
  - In the shell: `Rscript`

---

## Script example


```r
# Summarize subset of iris data

setosa &lt;- iris[iris$Species == "setosa", ]

summary(setosa)
```

Save  as `setosa.R`

In the shell, run with `Rscript setosa.R`

---

## Packages to consider

- `data.table` for fast, efficient data processing
- `tidyverse` family of packages
  - `readr`, `tidyr`, `dplyr`, `purrr`
- `tidymodels` family of packages
- `ggplot2` for advanced graphics
- `sf` for spatial data
- `renv` for reproducible package environments

---

## Additional resources

- [Swirl - Learn R in R](https://swirlstats.com/)
- [R for Reproducible Scientific Analysis lessons](https://swcarpentry.github.io/r-novice-gapminder/)
- [RStudio Primers](https://rstudio.cloud/learn/primers)
- [R Manuals](https://cran.r-project.org/manuals.html)
- [R package documentation](https://rdrr.io/)  
- [R cheatsheets](https://www.rstudio.com/resources/cheatsheets/)
- Web books
  - [Hands-on Programming with R](https://rstudio-education.github.io/hopr/)
  - [An Introduction to R](https://intro2r.com/)
  - [R Programming for Data Science](https://bookdown.org/rdpeng/rprogdatascience/)
  - [R for Data Science](https://r4ds.had.co.nz/)

---

## CARC support

- [Using R on CARC Systems](https://carc.usc.edu/user-information/user-guides/software-and-programming/r)
- [Submit a support ticket](https://carc.usc.edu/user-information/ticket-submission)
- [User Forum](https://hpc-discourse.usc.edu/)
- Office Hours
  - Every Tuesday 2:30-5pm
  - Register [here](https://carc.usc.edu/news-and-events/events)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:10"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
